<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Presupuesto - AXENTIA</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #D9DAD4;
      margin: 0;
      padding: 0;
      color: #303030;
    }
    header {
      background: #303030;
      color: #F5F1E8;
      padding: 20px;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      letter-spacing: 2px;
    }
    main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    section {
      background: #F5F1E8;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    section h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: #BEA167;
      border-bottom: 2px solid #BEA167;
      padding-bottom: 5px;
    }
    label {
      display: block;
      margin-top: 12px;
      font-size: 0.9rem;
      font-weight: bold;
      color: #303030;
    }
    input, select {
      width: calc(100% - 16px);
      padding: 10px;
      margin: 6px 0 14px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      background: #fff;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
      font-size: 0.95rem;
    }
    input:focus, select:focus {
      border-color: #BEA167;
      outline: none;
      box-shadow: 0 0 6px rgba(190,161,103,0.6);
      background: #F5F1E8;
    }
    button {
      margin-top: 15px;
      padding: 10px 15px;
      border: none;
      background: #BEA167;
      color: #303030;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s ease;
    }
    button:hover {
      background: #303030;
      color: #F5F1E8;
    }
    table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden;
      font-size: 0.95rem;
    }
    table th, table td {
      padding: 10px;
      text-align: center;
    }
    table th {
      background: #303030;
      color: #F5F1E8;
      font-weight: bold;
    }
    table tbody tr:nth-child(even) {
      background: #f0f0f0;
    }
    table tbody tr:hover {
      background: #e4e4e4;
    }
    .btn-eliminar {
      background: none;
      border: none;
      color: #BEA167;
      font-size: 1.2rem;
      cursor: pointer;
      transition: color 0.2s ease;
      vertical-align: middle;
    }
    .btn-eliminar:hover {
      color: #7a643e; /* dorado más oscuro en hover */
    }
    #resultado {
      margin: 20px;
      padding: 15px;
      background: #F5F1E8;
      border-radius: 10px;
      border: 1px solid #BEA167;
    }
    h3, h2 {
      color: #303030;
    }
  </style>
</head>
<body>
  <header>AXENTIA</header>

  <main>
    <!-- Datos de la empresa -->
    <section>
      <h2>Datos de la Empresa</h2>
      <label>Nombre</label>
      <input type="text" id="empresa_nombre" value="AXENTIA">
      <label>Dirección</label>
      <input type="text" id="empresa_direccion" value="Calle Ejemplo 123">
      <label>Email</label>
      <input type="email" id="empresa_mail" value="info@axentia.com">
      <label>Teléfono</label>
      <input type="text" id="empresa_tel" value="+54 11 6000 1234">
    </section>

    <!-- Datos del cliente -->
    <section>
      <h2>Datos del Cliente</h2>
      <label>Nombre</label>
      <input type="text" id="cliente_nombre">
      <label>Dirección</label>
      <input type="text" id="cliente_direccion">
      <label>Email</label>
      <input type="email" id="cliente_mail">
    </section>

    <!-- Datos del presupuesto -->
    <section>
      <h2>Datos del Presupuesto</h2>
      <label>Tipo de moneda</label>
      <select id="moneda" onchange="actualizarTabla(this.value)">
        <option value="USD">Dólar (USD)</option>
        <option value="EUR">Euro (EUR)</option>
        <option value="ARS">Peso Argentino (ARS)</option>
      </select>

      <label>Fecha</label>
      <input type="date" id="fecha">

      <label>Validez del presupuesto (días)</label>
      <input type="number" id="validez" min="1" placeholder="Ej: 30">

      <label>Forma de pago</label>
      <select id="pago">
        <option value="Efectivo">Efectivo</option>
        <option value="Cuenta Corriente">Cuenta Corriente</option>
        <option value="Transferencia">Transferencia</option>
        <option value="Cheque">Cheque</option>
      </select>
    </section>
  </main>

  <!-- Sección de productos -->
  <section style="margin:20px;">
    <h2>Productos</h2>
    <label>Descripción</label>
    <input type="text" id="producto_desc" placeholder="Ej: Monitor 24 pulgadas">
    <label>Cantidad</label>
    <input type="number" id="producto_cant" placeholder="Ej: 2" min="1">
    <label>Precio unitario</label>
    <input type="number" id="producto_precio" placeholder="Ej: 150.00" min="0" step="0.01">
    <button onclick="agregarProducto()">Agregar producto</button>

    <table id="tabla_productos">
      <thead>
        <tr>
          <th>Descripción</th>
          <th>Cantidad</th>
          <th>Precio Unitario</th>
          <th>Subtotal</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Impuestos -->
    <label>Impuesto (%)</label>
    <input type="number" id="impuesto" value="10.5" min="0" max="100" onchange="actualizarTabla(document.getElementById('moneda').value)">
    <h3>Total Neto: <span id="total">0</span> <span id="simbolo_moneda">USD</span></h3>
    <h3>Impuesto: <span id="impuesto_total">0</span> <span id="simbolo_moneda">USD</span></h3>
    <h2>Total Final: <span id="total_final">0</span> <span id="simbolo_moneda">USD</span></h2>
  </section>

  <div style="text-align:center;">
    <button onclick="generarPresupuesto()">Generar Presupuesto</button>
    <button onclick="descargarPDF()">Descargar PDF</button>
  </div>

  <div id="resultado"></div>

  <script>
    let productos = [];
    let total = 0;

    function agregarProducto() {
      const desc = document.getElementById("producto_desc").value;
      const cant = parseInt(document.getElementById("producto_cant").value);
      const precio = parseFloat(document.getElementById("producto_precio").value);
      const moneda = document.getElementById("moneda").value;

      if (!desc || isNaN(cant) || cant <= 0 || isNaN(precio) || precio < 0) {
        alert("Por favor, complete todos los datos del producto correctamente.");
        return;
      }

      const subtotal = cant * precio;
      productos.push({ desc, cant, precio, subtotal });

      actualizarTabla(moneda);
      document.getElementById("producto_desc").value = "";
      document.getElementById("producto_cant").value = "";
      document.getElementById("producto_precio").value = "";
    }

    function actualizarTabla(moneda) {
      const tbody = document.querySelector("#tabla_productos tbody");
      tbody.innerHTML = "";
      total = 0;

      productos.forEach((p, index) => {
        total += p.subtotal;
        const row = `
          <tr>
            <td>${p.desc}</td>
            <td>${p.cant}</td>
            <td>${p.precio.toFixed(2)} ${moneda}</td>
            <td>${p.subtotal.toFixed(2)} ${moneda}</td>
            <td><button class="btn-eliminar" onclick="eliminarProducto(${index})">🗑</button></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });

      const impuestoPorc = parseFloat(document.getElementById("impuesto").value) || 0;
      const impuestoTotal = (total * impuestoPorc) / 100;
      const totalFinal = total + impuestoTotal;

      document.getElementById("total").innerText = total.toFixed(2);
      document.getElementById("impuesto_total").innerText = impuestoTotal.toFixed(2);
      document.getElementById("total_final").innerText = totalFinal.toFixed(2);

      document.querySelectorAll("#simbolo_moneda").forEach(el => el.innerText = moneda);
    }

    function eliminarProducto(index) {
      productos.splice(index, 1);
      const moneda = document.getElementById("moneda").value;
      actualizarTabla(moneda);
    }

    function generarPresupuesto() {
      const empresa = {
        nombre: document.getElementById("empresa_nombre").value,
        direccion: document.getElementById("empresa_direccion").value,
        mail: document.getElementById("empresa_mail").value,
        tel: document.getElementById("empresa_tel").value
      };
      const cliente = {
        nombre: document.getElementById("cliente_nombre").value,
        direccion: document.getElementById("cliente_direccion").value,
        mail: document.getElementById("cliente_mail").value
      };
      const presupuesto = {
        moneda: document.getElementById("moneda").value,
        fecha: document.getElementById("fecha").value,
        validez: document.getElementById("validez").value,
        pago: document.getElementById("pago").value
      };

      if (!presupuesto.validez || presupuesto.validez < 1) {
        alert("La validez del presupuesto debe ser al menos 1 día.");
        return;
      }

      let html = `<h2>Presupuesto</h2>`;
      html += `<h3>Empresa</h3>
              <p>${empresa.nombre} - ${empresa.direccion}<br>
              ${empresa.mail} - ${empresa.tel}</p>`;
      html += `<h3>Cliente</h3>
              <p>${cliente.nombre} - ${cliente.direccion}<br>
              ${cliente.mail}</p>`;
      html += `<h3>Datos del presupuesto</h3>
              <p>Moneda: ${presupuesto.moneda}<br>
              Fecha: ${presupuesto.fecha}<br>
              Validez: ${presupuesto.validez} días<br>
              Forma de pago: ${presupuesto.pago}</p>`;
      document.getElementById("resultado").innerHTML = html;
    }

    function descargarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const empresa = {
        nombre: document.getElementById("empresa_nombre").value,
        direccion: document.getElementById("empresa_direccion").value,
        mail: document.getElementById("empresa_mail").value,
        tel: document.getElementById("empresa_tel").value
      };
      const cliente = {
        nombre: document.getElementById("cliente_nombre").value,
        direccion: document.getElementById("cliente_direccion").value,
        mail: document.getElementById("cliente_mail").value
      };
      const presupuesto = {
        moneda: document.getElementById("moneda").value,
        fecha: document.getElementById("fecha").value,
        validez: document.getElementById("validez").value,
        pago: document.getElementById("pago").value
      };

      doc.setFontSize(18);
      doc.text("Presupuesto - AXENTIA", 14, 20);

      doc.setFontSize(12);
      doc.text("Datos de la Empresa:", 14, 30);
      doc.text(`${empresa.nombre}`, 14, 36);
      doc.text(`${empresa.direccion}`, 14, 42);
      doc.text(`${empresa.mail} - ${empresa.tel}`, 14, 48);

      doc.text("Datos del Cliente:", 14, 60);
      doc.text(`${cliente.nombre}`, 14, 66);
      doc.text(`${cliente.direccion}`, 14, 72);
      doc.text(`${cliente.mail}`, 14, 78);

      doc.text("Datos del Presupuesto:", 14, 90);
      doc.text(`Moneda: ${presupuesto.moneda}`, 14, 96);
      doc.text(`Fecha: ${presupuesto.fecha}`, 14, 102);
      doc.text(`Validez: ${presupuesto.validez} días`, 14, 108);
      doc.text(`Forma de pago: ${presupuesto.pago}`, 14, 114);

      const columnas = ["Descripción", "Cantidad", "Precio Unitario", "Subtotal"];
      const filas = productos.map(p => [
        p.desc, p.cant, p.precio.toFixed(2) + " " + presupuesto.moneda, p.subtotal.toFixed(2) + " " + presupuesto.moneda
      ]);

      doc.autoTable({
        head: [columnas],
        body: filas,
        startY: 130,
      });

      const impuesto = parseFloat(document.getElementById("impuesto").value) || 0;
      const impuestoTotal = (total * impuesto) / 100;
      const totalFinal = total + impuestoTotal;

      let finalY = doc.lastAutoTable.finalY + 10;
      doc.text(`Total Neto: ${total.toFixed(2)} ${presupuesto.moneda}`, 14, finalY);
      doc.text(`Impuesto: ${impuestoTotal.toFixed(2)} ${presupuesto.moneda}`, 14, finalY + 6);
      doc.text(`Total Final: ${totalFinal.toFixed(2)} ${presupuesto.moneda}`, 14, finalY + 12);

      doc.save("presupuesto.pdf");
    }
  </script>
</body>
</html>
